# 义脉树枝图生成器打包说明

## 快速开始

### 方法一：一键打包（推荐）
1. 双击运行 `打包工具.bat`
2. 等待打包完成
3. 在 `dist` 文件夹中找到生成的 `义脉树枝图生成器.exe`

### 方法二：手动打包
1. 打开命令行，切换到项目目录
2. 运行：`python build_exe.py`
3. 等待打包完成

## 详细步骤

### 1. 环境准备
确保已安装Python 3.7+和pip，然后安装依赖：
```bash
pip install -r requirements.txt
```

### 2. 打包可执行文件
运行打包脚本：
```bash
python build_exe.py
```

打包脚本会自动：
- 安装PyInstaller（如果未安装）
- 创建PyInstaller配置文件
- 清理之前的构建文件
- 生成可执行文件

### 3. 生成的文件
打包完成后，会生成以下文件和目录：

```
YMTree/
├── dist/
│   └── 义脉树枝图生成器.exe    # 可执行文件
├── build/                      # 构建临时文件（可删除）
├── ymtree.spec                # PyInstaller配置文件
├── installer.iss              # Inno Setup安装脚本
└── README.md                  # 用户说明文档
```

### 4. 创建安装包（可选）

如果需要创建Windows安装包，需要额外步骤：

1. 下载并安装 [Inno Setup](https://jrsoftware.org/isinfo.php)
2. 用Inno Setup打开 `installer.iss` 文件
3. 点击"Build" -> "Compile"生成安装包
4. 安装包将生成在 `installer` 文件夹中

## 文件说明

### 核心文件
- `ymtree.py` - 主程序文件

- `database.py` - 数据库管理文件
- `*.db` - 数据库文件

### 打包文件
- `build_exe.py` - 打包脚本
- `打包工具.bat` - 一键打包批处理文件
- `requirements.txt` - Python依赖列表
- `ymtree.spec` - PyInstaller配置（自动生成）
- `installer.iss` - 安装包脚本（自动生成）

## 注意事项

1. **首次打包**：第一次运行可能需要下载依赖，请确保网络连接正常

2. **杀毒软件**：某些杀毒软件可能误报，请添加信任或临时关闭

3. **文件大小**：生成的exe文件约50-100MB，这是正常的（包含了Python运行时）

4. **兼容性**：生成的exe文件可在Windows 7及以上系统运行

5. **源码保留**：原始Python源码会保留在项目目录中，方便后续修改

## 故障排除

### 常见问题

**Q: 打包失败，提示找不到模块**
A: 检查是否安装了所有依赖：`pip install -r requirements.txt`

**Q: 生成的exe无法运行**
A: 可能是缺少依赖文件，检查ymtree.spec中的datas配置

**Q: 程序启动慢**
A: 这是正常现象，首次启动需要解压运行时文件

**Q: 想要更小的文件**
A: 可以修改ymtree.spec，使用--onedir模式而不是--onefile

### 手动调试
如果自动打包失败，可以手动运行PyInstaller：

```bash
# 基础打包
pyinstaller --onefile --windowed ymtree.py

# 包含数据文件
pyinstaller --onefile --windowed --add-data "database.py;." ymtree.py
```

## 分发说明

### 单文件分发
- 直接分发 `dist/义脉树枝图生成器.exe`
- 用户双击即可运行，无需安装

### 安装包分发
- 使用Inno Setup生成的安装包
- 提供完整的安装/卸载体验
- 可创建开始菜单和桌面快捷方式

### 源码分发
- 保留完整的Python源码
- 用户可以修改和定制
- 需要用户自行安装Python环境

## 更新说明

当需要更新程序时：
1. 修改源码文件
2. 重新运行打包脚本
3. 生成新的可执行文件
4. 如有需要，更新版本号和说明文档

---

**技术支持**：如有问题，请检查Python环境和依赖安装情况。